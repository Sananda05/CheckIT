{% extends 'src\Views\Users\Exams\Exam_Base.html' %}
{% block HomeContent %}

<!--static-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script type='text/javascript'>
  /* 
    $(document).ready(function(){
      var maxField = 100; //Input fields increment limitation
      var addButton = $('.add_button'); //Add button selector
      var wrapper = $('.field_wrapper'); //Input field wrapper
      var fieldHTML = '<tr><td><div class="form-group"><input type="text" class="form-control" name="ques_no[]" id="inputDefault"></div></td><td><div class="form-group"><input type="text" class="form-control" id="inputDefault" name="field_name[]" onkeyup="add(this.value)"></div></td><td><a href="javascript:void(0);" class="remove_button"><i class="mdi mdi-minus"></i></a></td></tr>'; //New input field html 
      var x = 1; //Initial field counter is 1
    
      //Once add button is clicked
      $(addButton).click(function(){
        //Check maximum number of input fields
        if(x < maxField){ 
          x++; //Increment field counter
          $(wrapper).append(fieldHTML); //Add field html
        }
      });
    
      //Once remove button is clicked
      $(wrapper).on('click', '.remove_button', function(e){
        e.preventDefault();

        var total = parseInt(document.getElementById('Total').value);
        var mark_to_be_reduced = parseInt($(this).closest("tr").find("input[name = 'field_name[]']").val());
        
        if( Number.isNaN(mark_to_be_reduced) ){
          mark_to_be_reduced = 0;
        }

        document.getElementById('Total').value = total - mark_to_be_reduced ;
        $(this).closest('tr').remove(); //Remove field html
        x--; //Decrement field counter
      });
    });

    function add(value){
      if( Number.isNaN(value) ){
          value = 0;
          document.getElementById('Total').value = marks + value;
      }
      else{
        marks = parseInt(document.getElementById("Total").value);
        int_value = parseInt(value);

        document.getElementById('Total').value = marks + int_value;
      }
    }
  */

  $(function () {
      //calculation script
      var $form = $("#whereEntry"),
      $sumDisplay = $("#income_sum");

      $form.delegate(".income_count", "change", function ()
      {
        var $summands = $form.find(".income_count");
        var sum = 0;
        $summands.each(function ()
        {
          var value = Number($(this).val());
          if (!isNaN(value)) sum += value;
        });

        $sumDisplay.val(sum);
      });
    });

    //add dynamic field script
    $(document).ready(function() {

    var MaxInputs       = 5; //maximum input boxes allowed
    var InputsWrapper   = $("#InputsIncomeWrapper"); //Input boxes wrapper ID
    var AddButton       = $("#AddMoreIncomeBox"); //Add button ID

    var x = InputsWrapper.length; //initlal text box count
    var FieldCount = 1; //to keep track of text box added

    $(AddButton).click(function (e)  //on add input button click
    {
      if(x <= MaxInputs) //max input box allowed
        {
          FieldCount++; //text box added increment
          //add input box
          $(InputsWrapper).append('\
          <tr>\
            <td><div class="form-group"><input type="text" class="form-control" id="inputDefault" name="ques_no[]"></div></td>\
            <td><div class="form-group"><input type="text" class="form-control income_count" id="income_count" name="field_name[]"></div></td>\
            <td><a href="#" id="AddMoreIncomeBox" class="removeclass"><i class="mdi mdi-minus"></i></a></td>\
          </tr>');
          x++; //text box increment
        }
      return false;
    });

    $("body").on("click",".removeclass", function(e){ //user click on remove text
      if( x > 1 ) {
        
        //Add
        var total = parseInt(document.getElementById('income_sum').value);
        var mark_to_be_reduced = parseInt($(this).closest("tr").find("input[name = 'field_name[]']").val()) || 0;

        document.getElementById('income_sum').value = total - mark_to_be_reduced ;

        $(this).closest('tr').remove(); //remove text box
        x--; //decrement textbox
      }
      return false;
    }) 

    });

  </script>

<!---->

<div class="page-wrapper mdc-toolbar-fixed-adjust row">
  <main class="content-wrapper" style = "padding-top: 0px;"> 
    <div style = "width: 65%; float: left; padding: 20px;">
      <embed
        src="{{ examScripts.pdf.url }}"
        type="application/pdf"
        frameBorder="0"
        scrolling="auto"
        height="650px"
        width="100%"
      ></embed>
    </div>
    <div style = "width: 35%; float: right; padding: 20px;">
      <span>
        <h1>Marks</h1><br>
        <a class="btn btn-primary btn-edit" href="uncheck/">Check Later</a>
      </span>
      <br><br>
      <form action = "" id="whereEntry" method = "post">
        {% csrf_token %}
        <table style = "text-align: center;" class="table table-hover field_wrapper">
          <tbody id="InputsIncomeWrapper">
            <tr style = "text-align: center;">
              <th>No.</th>
              <th>Mark</th>
              <th></th>
            </tr>
            <tr>
              <th>Total</td>
                <td><div class="form-group"><input type="text" class="form-control" id="income_sum" name="Marks" value = {{ examScripts.Marks }}></div></td>
                <td>
                  <input type='submit' class="btn btn-primary btn-edit" value = "Submit" />
                </td>
            </tr>
            {% for script_detail in script_details %}
              <tr>
                <td><div class="form-group"><input type="text" class="form-control" id="inputDefault" name="ques_no[]" value="{{ script_detail.ques_no }}"></div></td>    
                <td><div class="form-group"><input type="text" class="form-control income_count" id="inputDefault" name="field_name[]" value="{{ script_detail.Marks }}" onkeyup="add(this.value)"></div></td>
                <td><a href="#" id="AddMoreIncomeBox" class="add_button"><i class="mdi mdi-plus"></i></a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </form>
    </div>
  </main>
</div>

{% endblock %}